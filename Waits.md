A continuación se presenta una tabla con los tipos de esperas a usar en la automatizaciones del menos al mas recomendado.

| Tipo de espera | Calificación | Observaciones | Ejemplo |
|--|--|--|--|
| `Thread.sleep()` | El menos óptimo |- Ralentiza los tests <br> - Puede ocultar problemas genuinos de la aplicación. <br> - Hacen que la test suite sea propensa a fallos, si no son suficientemente largos.<br> - Los pasos son retrasados artificialmente.|  |
| `Target.wait()` <br> `Target.wait(…)` | El menos recomendado | - Es un método heredado de `java.lang.Object` utilizado para garantizar la sincronización de hilos de una manera segura. Este método hará que el hilo duerma hasta que ocurra algún evento que lo despierte o interrumpa. |  |
| Esperas implícitas | La más simple pero poco recomendada | - Aseguran que un test no falla si un elemento no está inmediatamente presente. <br> - La espera no discrimina por elemento, aplica para todos y en ocasiones podría generar tiempos de espera innecesarios. | `webdriver.timeouts.implicitlywait` <br> `setImplicitTimeout(5, SECONDS)` |
| Esperas explícitas (Web Element Facade Waits) | Más legibles | - Al igual que la anterior, permite establecer un tiempo máximo de espera hasta que se cumpla o no una condición. <br> - Es integrable a validaciones fluidas dentro de las Tareas, Interacciones o Questions de Screenplay. <br> - De no definir un timeout, por defecto serán 5 segundos. <br> - El intervalo sobre el cual se verifica la condición es cada 0.1 segundos. | `actor.attemptsTo(` <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`Ensure.that(target` <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`.waitingForNoMoreThan(`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`Duration.ofSeconds(sec)))`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`.isDisplayed());`|
| Esperas Fluidas (Fluent Waits) | Más sofisticados | - Permiten especificar el máximo periodo de tiempo para que se cumpla que un elemento ya presente esté visible o habilitado. <br> - Permite además, especificar la frecuencia con la cual verificar esa condición durante el periodo de tiempo definido. <br> - Es posible además, ignorar tipos específicos de excepciones mientras el periodo de espera está en ejecución para evitar fallos indeseados. <br> - Finalmente, se permite crear mensajes de error que correctamente configurados, servirán para personalizar excepciones. <br> - Por defecto se espera 0.5 segundos. <br> - El intervalo sobre el cual se verifica la condición es cada 0.5 segundos. | `withTimeout(Duration.ofSeconds(waitSec))` <br>&nbsp;&nbsp;&nbsp;&nbsp;.`pollingEvery(Duration.ofSeconds(pollSec))`<br>&nbsp;&nbsp;&nbsp;&nbsp;`.ignoring(exceptionToIgnore);` |
| Esperas explícitas (Webdriver Waits) | Una especialización del Fluent Wait | - Además de las bondades del Fluent Wait, permite establecer condiciones adicionales usando `ExpectedConditions` durante las esperas (visibilidad, presencia, etc). <br> - Una lista de condiciones se detalla en el siguiente [enlace](https://www.selenium.dev/selenium/docs/api/java/org/openqa/selenium/support/ui/ExpectedConditions.html) | `wait.until(presenceOfElementLocated`<br>&nbsp;&nbsp;&nbsp;&nbsp;`(By.xpath("//xpath")));` |
| Esperas explícitas (Screenplay `EventualConsequence`) | Muy recomendado | - Permite establecer una espera de una manera fluida a través del uso de `Hamcrest Matchers`. <br> - Habilita la configuración de excepciones en caso del no cumplimiento de las condiciones especificadas. <br> - Permite establecer un tiempo de espera máximo con el fin de no incurrir en esperas innecesarias. <br> - Es posible agregar leyendas explicativas acerca del proceso de validación que generarán una documentación más robusta. <br> - Es posible además, ignorar tipos específicos de excepciones mientras el periodo de espera está en ejecución para evitar fallos indeseados. <br> - Por defecto la espera se realiza durante 2 segundos (o lo configurado en el Implicit Wait). <br> - Integrable con la interfaz `Performable` lo que le permite extenderse a esperas durante la ejecución de una tarea o interacción. <br> - El intervalo sobre el cual se verifica la condición es cada 0.1 segundos. | `then(actor).should(eventually(seeThat`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`(CurrentPage.heading(), is(`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`equalTo("Software engineering.”)))));` |
| Esperas explícitas (Screenplay `WaitUntil`) | Muy recomendado | - Hace uso del la consecuencia eventual de Screenplay. <br> - Permite establecer una espera fluida. <br> - Es una interacción, lo que permite ser usada sin ningún problema en las tareas y otras interacciones. <br> - Permite establecer un tiempo de espera máximo con el fin de no incurrir en esperas innecesarias. <br> - Igualmente de manera fluida, es posible definir acciones después de que la espera es cumplida. | `WaitUntil.the(target, isVisible())`<br>&nbsp;&nbsp;&nbsp;&nbsp;`.forNoMoreThan(1).seconds()`<br>&nbsp;&nbsp;&nbsp;&nbsp;`.then(Click.on(target))` |


### **ADVERTENCIA:** No mezcle esperas implícitas y explícitas. Hacerlo puede causar tiempos de espera impredecibles. Por ejemplo, establecer una espera implícita de 10 segundos y una espera explícita de 15 segundos podría provocar un tiempo de espera después de 20 segundos. _(Tomado de la documentación oficial de Selenium)._


## Algunos ejemplos:
Puede dirigirse al siguiente [repositorio](https://grupobancolombia.visualstudio.com/Vicepresidencia%20Servicios%20de%20Tecnolog%C3%ADa/_git/Curiosity_NU0007001_ArquitectucturaAutomatizacionTest?path=%2Fotros-ejemplos%2Fwaits-examples) para encontrar **ejemplos** de implementación.

### Documentación de referencia:
- [Handling Waits and Asynchronous Pages in Serenity BDD](https://johnfergusonsmart.com/handling-waits-and-asynchronous-pages-in-serenity-bdd/)
- [Working with timeouts](http://serenitydoc.blogspot.com/2015/09/95-working-with-timeouts.html)
- [Waiting for elements and defining timeouts](https://serenity-bdd.github.io/theserenitybook/latest/serenity-screenplay-ensure.html#_waiting_for_elements_and_defining_timeouts)
- [Selenium Waits](https://www.selenium.dev/documentation/en/webdriver/waits/)
